@inject NavigationManager NavigationManager

<AuthorizeView>
    <Authorized>
        <CreateObjectButton Class="mr-6" />
        <UserButton Class="me-4" OnClickSetting="OnOpenSetting" />
    </Authorized>
    <NotAuthorized>
        <CnGalWebSite.Shared.MasaComponent.Shared.Components.MasaButton Icon="mdi-login" Class="mr-6" Tooltip="登入" OnClick="OnLogin" />
        <CnGalWebSite.Shared.MasaComponent.Shared.Components.MasaButton Icon="mdi-cog" Class="me-4" Tooltip="设置" OnClick="OnOpenSetting" StopPropagation />
    </NotAuthorized>
</AuthorizeView>
@if (isOpen)
{
    <ThemeSettingCard @ref="themeSettingCard" />
}
@code {
    ThemeSettingCard themeSettingCard;
    bool isOpen;

    protected void OnLogin()
    {
        if (ToolHelper.IsSSR)
        {
            NavigationManager.NavigateTo($"Account/Login?returnUrl={NavigationManager.Uri.Replace(NavigationManager.BaseUri, "")}", true);
        }
        else
        {
            NavigationManager.NavigateToLogin("authentication/login");
        }
    }

    public void OnOpenSetting()
    {
        isOpen = true;
        StateHasChanged();
        if (themeSettingCard != null)
        {
            themeSettingCard.Refresh(true);
        }
    }
}
