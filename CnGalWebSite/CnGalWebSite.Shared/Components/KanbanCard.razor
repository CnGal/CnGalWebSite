@inject IDataCacheService _dataCacheService
@inject IEventService _eventService
@inject ILive2DService _live2DService

@implements IDisposable

@if (isReady)
{
    @if (_dataCacheService.ThemeSetting.HideKanban)
    {
        <CnGalWebSite.Shared.MasaComponent.Shared.Tips.FloatToolTip @ref="FloatTool" />
    }
    else
    {
        <CnGalWebSite.Kanban.KanbanLive2D>
            <CnGalWebSite.Kanban.Components.Buttons.ExternalButton @ref="ExternalButton"/>
        </CnGalWebSite.Kanban.KanbanLive2D>
    }
}


@code {
    bool isReady;
    bool hide;

    CnGalWebSite.Shared.MasaComponent.Shared.Tips.FloatToolTip FloatTool;
    CnGalWebSite.Kanban.Components.Buttons.ExternalButton ExternalButton;

    protected override void OnInitialized()
    {
        _eventService.KanbanChanged -= OnKanbanChanged;
        _eventService.KanbanChanged += OnKanbanChanged;
    }

    public void DisplayArticleCatalogButton(ArticleViewModel model)
    {
        if (FloatTool!=null)
        {
            FloatTool?.DisplayArticleCatalogButton(model);
        }
        else if(ExternalButton!=null)
        {
            ExternalButton?.DisplayArticleCatalogButton(model);
        }
       
    }

    public async void OnKanbanChanged()
    {
        isReady = true;
        await InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        _eventService.KanbanChanged -= OnKanbanChanged;
        GC.SuppressFinalize(this);
    }

}
