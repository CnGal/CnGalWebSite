@inject NavigationManager NavigationManager

<AuthorizeView>
    <Authorized>
        <CreateObjectButton Class="mr-2" />
        <UserButton Class="me-4" OnClickSetting="OnOpenSetting" />
    </Authorized>
    <NotAuthorized>
        <CnGalWebSite.Shared.MasaComponent.Shared.Components.MasaButton Icon="mdi-login" Class="mr-2" Tooltip="登入" OnClick="OnLogin" />
        <CnGalWebSite.Shared.MasaComponent.Shared.Components.MasaButton Icon="mdi-cog" Class="me-2" Tooltip="设置" OnClick="OnOpenSetting" StopPropagation />
    </NotAuthorized>
</AuthorizeView>
@if (isOpen)
{
    <ThemeSettingCard @ref="themeSettingCard" />
}
@code {
    ThemeSettingCard themeSettingCard;
    bool isOpen;

    protected void OnLogin()
    {
        InteractiveRequestOptions requestOptions = new()
        {
            Interaction = InteractionType.SignIn,
            ReturnUrl = NavigationManager.Uri,
        };


        if (ToolHelper.IsSSR)
        {
            NavigationManager.NavigateTo($"Account/Login?returnUrl={NavigationManager.Uri}", true);
        }
        else
        {
            NavigationManager.NavigateToLogin("authentication/login", requestOptions);
        }
    }


    public void OnOpenSetting()
    {
        isOpen = true;
        StateHasChanged();
        if (themeSettingCard != null)
        {
            themeSettingCard.Refresh(true);
        }
    }
}
