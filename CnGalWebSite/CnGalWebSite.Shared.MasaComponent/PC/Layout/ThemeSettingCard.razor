@inject IDataCacheService _dataCacheService
@inject IEventService _eventService

<MDialog @bind-Value="Dialog"
         MaxWidth="440">
    <MCard>
        <MCardTitle Class="text-h5">
            主题设置
        </MCardTitle>
        <MCardTitle Class="text-h6">
            主题颜色
        </MCardTitle>
        <MCardText>

            你可以从下方选择一个喜欢的颜色作为主题颜色，选择黑色可以进入夜间模式
        </MCardText>

        <MCardText>
            <MButtonGroup Borderless Value="@_dataCacheService.ThemeSetting.ThemeColor" ValueChanged="ColorValueChanged" Style="display: flex; flex-wrap: wrap; border-radius: 0; " Class="color-selector-card">
                 @foreach (var item in ThemeModel.AvailableColors)
                {
                    <MButton Value="@item" Color="@item" Small Style="min-width: 28px;" />
                }
            </MButtonGroup>
        </MCardText>
        <MCardTitle Class="text-h6">
            主题模式
        </MCardTitle>
        <MCardText>
            可以选择深色或浅色模式，也可以跟随系统主题设置
        </MCardText>
        <MCardText Class="pb-0">
            <CnGalWebSite.Components.Inputs.MasaSelecte Value="@_dataCacheService.ThemeSetting.ThemeMode" ValueChanged="ThemeModeValueChanged" TValue="ThemeMode" Label="主题模式" />
        </MCardText>
        <MCardTitle Class="text-h6">
            背景图
        </MCardTitle>
        <MCardText>
            显示背景图会将卡片设置为半透明状态，目前建议使用明亮的图片作为背景
        </MCardText>
        <MCardText Class="pb-0">
            <MSwitch Value="_dataCacheService.ThemeSetting.IsTransparent" TValue="bool" ValueChanged="BackgroundValueChanged" Label="@(_dataCacheService.ThemeSetting.IsTransparent?"显示背景图":"隐藏背景图")" Class="m-0"></MSwitch>
        </MCardText>
        <MCardTitle Class="text-h6">
            扩展显示范围
        </MCardTitle>
        <MCardText>
            选中后将把显示范围扩大到整个页面，也就是两边留白区域缩小
        </MCardText>
        <MCardText Class="pb-0">
            <MSwitch Value="_dataCacheService.ThemeSetting.IsExtendEntireScreen" TValue="bool" ValueChanged="ExpandValueChanged" Label="@(_dataCacheService.ThemeSetting.IsExtendEntireScreen?"扩展显示范围":"限制显示范围")" Class="m-0"></MSwitch>
        </MCardText>
        <MCardTitle Class="text-h6">
            词条样式模板
        </MCardTitle>
        <MCardText>
            选择词条页面的布局排版样式
        </MCardText>
        <MCardText Class="pb-0">
            <CnGalWebSite.Components.Inputs.MasaSelecte Value="@_dataCacheService.ThemeSetting.EntryTemplate" ValueChanged="EntryTemplateValueChanged" TValue="EntryStyleTemplate" Label="词条样式模板" />
        </MCardText>
        <MCardTitle Class="text-h6">
            字体
        </MCardTitle>
        <MCardText>
            自定义渲染的字体，具体参见更新日志
        </MCardText>

        <MCardText Class="pb-0">
            <MTextField Label="字体" Value="@_dataCacheService.ThemeSetting.FontFamily" ValueChanged="FontFamilyValueChanged" TValue="string"></MTextField>
        </MCardText>
        <MCardTitle Class="text-h6">
            自动保存编辑
        </MCardTitle>
        <MCardText>
            在编辑页面时间隔10秒自动保存一次数据
        </MCardText>
        <MCardText Class="pb-0">
            <MSwitch Value="@_dataCacheService.ThemeSetting.AllowAutoSave" TValue="bool" ValueChanged="AllowAutoSaveValueChanged" Label="@(_dataCacheService.ThemeSetting.AllowAutoSave?"自动保存":"不自动保存")" Class="m-0"></MSwitch>
        </MCardText>
        <MCardTitle Class="text-h6">
            显示错误详情
        </MCardTitle>
        <MCardText>
            展示网站发生错误时的详细信息
        </MCardText>
        <MCardText Class="pb-0">
            <MSwitch Value="@_dataCacheService.ThemeSetting.ShowDetailedErrorInfor" TValue="bool" ValueChanged="ShowDetailedErrorInforValueChanged" Label="@(@_dataCacheService.ThemeSetting.ShowDetailedErrorInfor?"显示":"不显示")" Class="m-0"></MSwitch>
        </MCardText>
    </MCard>
</MDialog>

@code {
    bool Dialog { get; set; }

    [CascadingParameter]
    private CnGalWebSite.Shared.MasaComponent.Shared.Tips.CnGalRootTip CnGalRootTip { get; set; }

    public void Refresh(bool dialog)
    {
        Dialog = dialog;
        StateHasChanged();

    }

    public void ColorValueChanged(StringNumber value)
    {
        if (value == null)
        {
            return;
        }

        _dataCacheService.ThemeSetting.ThemeColor = value.ToString();

        _eventService.OnSavaTheme();
    }

    public void BackgroundValueChanged(bool show)
    {
        _dataCacheService.ThemeSetting.IsTransparent = show;

        _eventService.OnSavaTheme();

    }
    public void ExpandValueChanged(bool expand)
    {
        _dataCacheService.ThemeSetting.IsExtendEntireScreen = expand;

        _eventService.OnSavaTheme();

    }

    public void FontFamilyValueChanged(string value)
    {
        _dataCacheService.ThemeSetting.FontFamily = value;

        _eventService.OnSavaTheme();

    }

    public void AllowAutoSaveValueChanged(bool value)
    {
        _dataCacheService.ThemeSetting.AllowAutoSave = value;

        _eventService.OnSavaTheme();

    }

    public void ShowDetailedErrorInforValueChanged(bool value)
    {
        _dataCacheService.ThemeSetting.ShowDetailedErrorInfor = value;
        _eventService.OnSavaTheme();
    }

    public void EntryTemplateValueChanged(EntryStyleTemplate temp)
    {
        _dataCacheService.ThemeSetting.EntryTemplate = temp;
        _eventService.OnSavaTheme();
    }

    public void ThemeModeValueChanged(ThemeMode temp)
    {
        _dataCacheService.ThemeSetting.ThemeMode = temp;
        _eventService.OnSavaTheme();
    }
}

