@typeparam TValue where TValue : BaseImageEditModel, new()


@inject IHttpService _httpService


<CnGalWebSite.Shared.MasaComponent.Shared.Editors.Buttons.ImageUploadButton Multiple Text="上传图片到图床" Icon="IconType.CloudUpload" OnImageUploaded="AddImage" ShowPreview="false" />
 @if (Model.Count != 0)
{
    <MRow>
        @foreach (var item in Model.OrderByDescending(s => s.Priority))
        {
            <MCol Cols="12" Md="6" Lg="4" Xl="3">
                <img src="@item.Image" alt="@item.Note" class="w-100 mb-3">
                <div class="mb-4" style="display: flex;justify-content: space-between;">
                    <CnGalWebSite.Shared.MasaComponent.Shared.Components.MasaButton Color="success" Text="编辑" Icon="@IconType.Edit.ToIconString()" OnClick="@(()=> EditImage(item))" />
                    <CnGalWebSite.Shared.MasaComponent.Shared.Components.MasaButton Color="error" Text="删除" Icon="@IconType.Delete.ToIconString()" OnClick="@(()=> DeleteImage(item))" />
                </div>
            </MCol>
        }
    </MRow>
}

@if (_model != null)
{
    <MDialog @bind-Value="_editDialog"
             MaxWidth="800">
        <MDCard>
            <MCardTitle>
                编辑图片
            </MCardTitle>
            <MCardText>
                <MRow>
                    <MCol Cols="12" Md="6">
                        <CnGalWebSite.Shared.MasaComponent.Shared.Editors.Buttons.ImageUploadButton @bind-ImagePath="@_model.Image" Type="ImageAspectType.None" Text="上传图片" />
                    </MCol>
                    <MCol Cols="12">
                        <MDivider />
                    </MCol>
                    <MCol Cols="12" Xl="6">
                        <MTextField @bind-Value="_model.Note" Label="备注" />
                    </MCol>
                    <MCol Cols="12" Xl="6">
                        <MTextField @bind-Value="_model.Priority" Label="优先级" />
                    </MCol>
                    @if (_model is EditWebsiteImageModel)
                    {
                        var _temp = _model as EditWebsiteImageModel;
                        <MCol Cols="12" Xl="6">
                            <CnGalWebSite.Components.Inputs.MasaSelecte @bind-Value="_temp.Type" TValue="EntryWebsiteImageType" Label="类型" />
                        </MCol>
                        <MCol Cols="12" Xl="6">
                            <CnGalWebSite.Components.Inputs.MasaSelecte @bind-Value="_temp.Size" TValue="EntryWebsiteImageSize" Label="大小" />
                        </MCol>
                    }
                </MRow>

            </MCardText>
        </MDCard>
    </MDialog>
}


@code {
    [Parameter]
    public List<TValue> Model { get; set; } = new List<TValue>();

    private bool _editDialog;
    TValue _model;


    public void DeleteImage(TValue model)
    {
        Model.Remove(model);
        StateHasChanged();
    }
    public void EditImage(TValue model)
    {
        _editDialog = true;
        _model = model;
        StateHasChanged();
    }

    public void AddImage(string url)
    {
        Model.Add(new TValue
            {
                Image = url
            });
        StateHasChanged();
    }
}
