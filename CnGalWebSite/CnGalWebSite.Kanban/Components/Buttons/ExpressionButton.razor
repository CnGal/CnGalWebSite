@inject ISettingService _settingService
@inject IRepository<ExpressionModel> _expressionRepository
@inject IJSRuntime JS
@inject ILive2DService _live2DService

<CnGalWebSite.Kanban.Components.Shared.FloatButton Image="./_content/CnGalWebSite.Kanban/images/face.png" ShowMenu Tooltip="表情">
     <MenuContent>
         <MList Dense>
            <MListItemGroup Value="_index" ValueChanged="SwitchExpression"
                            Color="primary">
                @foreach (var item in _expressionRepository.GetAll())
                {
                    <MListItem>
                        <MListItemContent>
                            <MListItemTitle>@item.DisplayName</MListItemTitle>
                        </MListItemContent>
                    </MListItem>
                }
                <MListItem>
                    <MListItemContent>
                        <MListItemTitle>清空</MListItemTitle>
                    </MListItemContent>
                </MListItem>
            </MListItemGroup>
        </MList>

    </MenuContent>
</CnGalWebSite.Kanban.Components.Shared.FloatButton>

@code {
    public StringNumber _index;

    public async Task SwitchExpression(StringNumber index)
    {
        _index = index;
        if (index.ToInt32() == _expressionRepository.GetAll().Count)
        {
            await _live2DService.CleanExpression();
        }
        else
        {
            await _live2DService.SetExpression(index.ToInt32());
        }
    }
}
